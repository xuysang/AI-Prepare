<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AIç®€å†åŒ¹é…åˆ†æ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        textarea {
            resize: vertical;
            min-height: 150px;
        }
        .result-card {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
<div class="container py-4">
    <h1 class="mb-4 text-center">ğŸ“„ AI ç®€å†åŒ¹é…åº¦åˆ†æ</h1>

    <div class="row g-4">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <label for="jd" class="form-label fw-bold">å²—ä½æè¿° (JD)</label>
                    <textarea id="jd" class="form-control" placeholder="è¯·è¾“å…¥å²—ä½æè¿°"></textarea>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <label for="resume" class="form-label fw-bold">ç®€å†å†…å®¹</label>
                    <textarea id="resume" class="form-control" placeholder="è¯·è¾“å…¥ç®€å†å†…å®¹"></textarea>
                </div>
            </div>
        </div>
    </div>

    <div class="text-center mt-4">
        <button class="btn btn-primary btn-lg px-4" onclick="analyze()">ğŸš€ åˆ†æåŒ¹é…åº¦</button>
    </div>

    <div id="output" class="result-card mt-4 d-none">
        <h5 class="fw-bold mb-3">åˆ†æç»“æœ</h5>

        <!-- åŒ¹é…åº¦è¿›åº¦æ¡ -->
        <div class="mb-3">
            <label class="form-label fw-bold">ğŸ¯ åŒ¹é…åº¦</label>
            <div class="progress" style="height: 30px;">
                <div 
                    id="match-bar" 
                    class="progress-bar progress-bar-striped progress-bar-animated bg-success" 
                    role="progressbar" 
                    style="width: 0%">0%</div>
            </div>
        </div>

        <!-- æ”¹è¿›å»ºè®® -->
        <p id="advice" class="mt-3"></p>
    </div>
</div>

<script>
async function analyze(){
    const jd = document.getElementById("jd").value.trim();
    const res = document.getElementById("resume").value.trim();
    if (!jd || !res) {
        alert("è¯·å¡«å†™å²—ä½æè¿°å’Œç®€å†å†…å®¹ï¼");
        return;
    }

    // æ˜¾ç¤ºç»“æœåŒºåŸŸ & é‡ç½®è¿›åº¦æ¡
    document.getElementById("output").classList.remove("d-none");
    updateProgress(0); 
    document.getElementById("advice").innerHTML = "â³ æ­£åœ¨åˆ†æï¼Œè¯·ç¨å€™...";

    try {
        // è¯·æ±‚åŒ¹é…åº¦
        let matchResp = await fetch("http://127.0.0.1:8000/match", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({jd: jd, resume: res})
        });
        let matchData = await matchResp.json();

        // è¯·æ±‚å»ºè®®
        let adviceResp = await fetch("http://127.0.0.1:8000/advice", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({jd: jd, resume: res})
        });
        let adviceData = await adviceResp.json();

        // åŠ¨ç”»å¡«å……è¿›åº¦æ¡
        animateProgress(matchData.åŒ¹é…åº¦);

        // æ˜¾ç¤ºå»ºè®®
        document.getElementById("advice").innerHTML = `ğŸ’¡ <strong>æ”¹è¿›å»ºè®®ï¼š</strong> ${adviceData.å»ºè®®}`;
    } catch (error) {
        document.getElementById("advice").innerHTML = "âŒ åˆ†æå¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯ç”¨";
        console.error(error);
    }
}

// æ›´æ–°è¿›åº¦æ¡
function updateProgress(value) {
    let bar = document.getElementById("match-bar");
    bar.style.width = value + "%";
    bar.textContent = value + "%";
}

// åŠ¨ç”»æ•ˆæœ
function animateProgress(target) {
    let value = 0;
    let interval = setInterval(() => {
        if (value >= target) {
            clearInterval(interval);
        } else {
            value++;
            updateProgress(value);
        }
    }, 15); // æ•°å­—è¶Šå°åŠ¨ç”»è¶Šå¿«
}
</script>
</body>
</html>
