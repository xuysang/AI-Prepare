<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AI简历匹配分析</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        textarea {
            resize: vertical;
            min-height: 150px;
        }
        .result-card {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
<div class="container py-4">
    <h1 class="mb-4 text-center">📄 AI 简历匹配度分析</h1>

    <div class="row g-4">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <label for="jd" class="form-label fw-bold">岗位描述 (JD)</label>
                    <textarea id="jd" class="form-control" placeholder="请输入岗位描述"></textarea>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <label for="resume" class="form-label fw-bold">简历内容</label>
                    <textarea id="resume" class="form-control" placeholder="请输入简历内容"></textarea>
                </div>
            </div>
        </div>
    </div>

    <div class="text-center mt-4">
        <button class="btn btn-primary btn-lg px-4" onclick="analyze()">🚀 分析匹配度</button>
    </div>

    <div id="output" class="result-card mt-4 d-none">
        <h5 class="fw-bold mb-3">分析结果</h5>

        <!-- 匹配度进度条 -->
        <div class="mb-3">
            <label class="form-label fw-bold">🎯 匹配度</label>
            <div class="progress" style="height: 30px;">
                <div 
                    id="match-bar" 
                    class="progress-bar progress-bar-striped progress-bar-animated bg-success" 
                    role="progressbar" 
                    style="width: 0%">0%</div>
            </div>
        </div>

        <!-- 改进建议 -->
        <p id="advice" class="mt-3"></p>
    </div>
</div>

<script>
async function analyze(){
    const jd = document.getElementById("jd").value.trim();
    const res = document.getElementById("resume").value.trim();
    if (!jd || !res) {
        alert("请填写岗位描述和简历内容！");
        return;
    }

    // 显示结果区域 & 重置进度条
    document.getElementById("output").classList.remove("d-none");
    updateProgress(0); 
    document.getElementById("advice").innerHTML = "⏳ 正在分析，请稍候...";

    try {
        // 请求匹配度
        let matchResp = await fetch("http://127.0.0.1:8000/match", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({jd: jd, resume: res})
        });
        let matchData = await matchResp.json();

        // 请求建议
        let adviceResp = await fetch("http://127.0.0.1:8000/advice", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({jd: jd, resume: res})
        });
        let adviceData = await adviceResp.json();

        // 动画填充进度条
        animateProgress(matchData.匹配度);

        // 显示建议
        document.getElementById("advice").innerHTML = `💡 <strong>改进建议：</strong> ${adviceData.建议}`;
    } catch (error) {
        document.getElementById("advice").innerHTML = "❌ 分析失败，请检查后端服务是否可用";
        console.error(error);
    }
}

// 更新进度条
function updateProgress(value) {
    let bar = document.getElementById("match-bar");
    bar.style.width = value + "%";
    bar.textContent = value + "%";
}

// 动画效果
function animateProgress(target) {
    let value = 0;
    let interval = setInterval(() => {
        if (value >= target) {
            clearInterval(interval);
        } else {
            value++;
            updateProgress(value);
        }
    }, 15); // 数字越小动画越快
}
</script>
</body>
</html>
